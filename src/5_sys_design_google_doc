# ðŸ“ Google Docs â€“ Senior Frontend System Design (Sticky Notes)

---

## 1ï¸âƒ£ What Is Google Docs?

**1-liner:** A real-time collaborative document editor that supports multiple users editing the same document with strong consistency, offline support, and high performance.

---

## 2ï¸âƒ£ What Interviewers Expect (Senior Frontend)

### âŒ NOT expected

* Designing distributed databases from scratch
* Implementing CRDT/OT math proofs

### âœ… Expected

* Clear collaboration model understanding
* Frontend data flow + sync strategy
* Offline-first + conflict handling
* Performance at scale

---

## 3ï¸âƒ£ Core Requirements Breakdown

| Requirement       | Meaning              |
| ----------------- | -------------------- |
| Reliability       | No data loss         |
| In-order edits    | Correct sequence     |
| Multi-user        | 10â€“100 editors       |
| Offline           | Edit without network |
| Conflict handling | Merge edits          |
| Performance       | Low latency typing   |

---

## 4ï¸âƒ£ High-Level Architecture (Sticky Diagram)

```
UI Editor
 â”œâ”€ Cursor
 â”œâ”€ Selection
 â”œâ”€ Toolbar

Collab Engine (FE)
 â”œâ”€ Operation Queue
 â”œâ”€ Version Tracker
 â”œâ”€ OT / CRDT Adapter
 --> CRDT (Conflict-free Replicated Data Types)
CRDT ensures all replicas converge automatically without transforming operations or relying on ordering.
Instead of fixing conflicts after they happen,
CRDT designs data structures that cannot conflict.
----> OT (Operational Transformation)
OT transforms concurrent edits so all users end up with the same document, while preserving each userâ€™s intent.
Intuition (Non-math)
Multiple users edit the same document at the same time.
Their edits arrive in different orders on different machines.

Network Layer
 â”œâ”€ WebSocket
 â”œâ”€ Retry / ACK

Local Storage
 â”œâ”€ IndexedDB
 â”œâ”€ Offline Ops

Backend (Awareness)
 â”œâ”€ Ordering
 â”œâ”€ Fan-out
```

---

## 5ï¸âƒ£ Data Model (Frontend View)

### Document = Operations, not text

```
Insert("A", pos=5)
Delete(len=3, pos=8)
```

Why:

* Easier merge
* Smaller payloads
* Real-time sync

---

## 6ï¸âƒ£ In-Order Delivery (CRITICAL)

**Problem:** Network packets arrive out of order

### Solution (Frontend):

* Assign sequence numbers
* Apply only next expected version

```
Ops: 1 â†’ 2 â†’ 3 â†’ 4
Arrives: 1, 3, 2
Apply: 1 â†’ 2 â†’ 3
```

---

## 7ï¸âƒ£ Collaboration Model

### Two Industry Approaches

| Model                      | Used By       |
| -------------------------- | ------------- |
| OT (Operational Transform) | Google Docs   |
| CRDT                       | Figma, Notion |

---

## 8ï¸âƒ£ OT (Operational Transform) â€“ Interview Level

**1-liner:** Transforms concurrent operations so everyone sees the same document.

```
User A: Insert "X" @5
User B: Insert "Y" @5

Transform â†’ deterministic order
```

Frontend Role:

* Apply transformed ops
* Maintain local cursor

---

## 9ï¸âƒ£ Conflict Handling (User POV)

Conflicts rarely visible

* System auto-merges
* Last-write-wins avoided

```
Edit A + Edit B
 â†’ Transformed
 â†’ Same result
```

---

## ðŸ”Ÿ Offline Support (VERY IMPORTANT)

### Offline-First Strategy

```
User Edit
 â†“
Local Apply
 â†“
Queue Operation
 â†“ (online)
Sync
```

Stored in:

* IndexedDB

---

## 1ï¸âƒ£1ï¸âƒ£ Re-sync After Offline

Steps:

1. Fetch latest doc version
2. Replay offline ops
3. Transform if needed

```
Server v10
Offline ops (v7)
â†’ transform â†’ v11
```

---

## 1ï¸âƒ£2ï¸âƒ£ Reliability & Durability

Frontend Guarantees:

* ACK-based sending
* Retry unacked ops
* Persist ops locally

```
Send â†’ ACK â†’ Clear
No ACK â†’ Retry
```

---

## 1ï¸âƒ£3ï¸âƒ£ Multi-Participant Scaling

Challenges:

* Cursor storms
* Too many updates

Solutions:

* Throttle cursor updates
* Batch ops

```
Typing â†’ batch â†’ send
```

---

## 1ï¸âƒ£4ï¸âƒ£ Cursor & Presence (Senior Signal)

Separate channel:

* Cursor position
* User color

```
Presence â‰  Document Data
```

---

## 1ï¸âƒ£5ï¸âƒ£ Performance (Typing Must Be Instant)

Rules:

* Apply local edits synchronously
* Network async

```
Keypress â†’ DOM update â†’ sync later
```

Optimizations:

* Rope / piece table
* Avoid full re-render

---

## 1ï¸âƒ£6ï¸âƒ£ Rendering Strategy (Frontend)

* Virtualized document blocks
* Avoid contenteditable pitfalls

```
Large Doc
 â†“
Render visible blocks only
```

---

## 1ï¸âƒ£7ï¸âƒ£ Network Layer

* WebSocket (bi-directional)
* Heartbeats
* Reconnect logic

```
FE â‡„ WS â‡„ Server
```

---

## 1ï¸âƒ£8ï¸âƒ£ Failure Scenarios (Interview Gold)

| Failure   | Handling               |
| --------- | ---------------------- |
| WS drop   | Reconnect + replay     |
| Tab crash | Restore from IndexedDB |
| Conflict  | OT resolve             |

---

## 1ï¸âƒ£9ï¸âƒ£ Security (Awareness)

* Auth tokens
* Doc permissions
* Sanitized input

---

## â­ Interview Gold Summary (Memorize)

> "Google Docs is built as an offline-first, operation-based editor. On the frontend, edits ar
